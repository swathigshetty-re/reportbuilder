<!DOCTYPE html>
<html>
<head>
<title>Register</title>
<style>
body{
    font-family: Arial;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    background:linear-gradient(135deg,#43cea2,#185a9d);
}

.register-box{
    background:white;
    padding:30px;
    width:320px;
    border-radius:8px;
}

input{
    width:100%;
    padding:10px;
    margin:10px 0;
}

button{
    width:100%;
    padding:10px;
    background:#185a9d;
    color:white;
    border:none;
    cursor:pointer;
}

button:hover{
    background:#144a82;
}

#message{
    margin-top:10px;
    font-size:14px;
}
</style>
</head>
<body>

<div class="register-box">
    <h2 id="roleTitle">Register</h2>

    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <input type="password" id="confirmPassword" placeholder="Confirm Password">

    <button onclick="register()">Register</button>

    <div id="message"></div>

    <p style="text-align:center;margin-top:15px;">
        Already have account?
        <a id="loginLink" href="login.html">Login</a>
    </p>
</div>

<script>

// Get role from URL
const params = new URLSearchParams(window.location.search);
const role = params.get("role") || "viewer";

// Update title
document.getElementById("roleTitle").innerText =
    role === "admin" ? "Admin Register" : "Viewer Register";

// Update login link
document.getElementById("loginLink").href =
    "login.html?role=" + role;

async function register() {

    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    const confirmPassword = document.getElementById("confirmPassword").value.trim();
    const message = document.getElementById("message");

    message.style.color = "red";
    message.innerText = "";

    // Validation
    if (!username || !password || !confirmPassword) {
        message.innerText = "All fields are required";
        return;
    }

    if (password !== confirmPassword) {
        message.innerText = "Passwords do not match";
        return;
    }

    try {
        const response = await fetch("../backend/auth/register.php", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                username: username,
                password: password,
                role: role
            })
        });

        // Check if response is OK
        if (!response.ok) {
            throw new Error("Network response was not ok");
        }

        const result = await response.json();

        if (result.status === "success") {
            message.style.color = "green";
            message.innerText = "Registration successful!";
            
            setTimeout(() => {
                window.location.href = "login.html?role=" + role;
            }, 1000);

        } else if (result.status === "exists") {
            message.innerText = "Username already exists";

        } else if (result.status === "empty") {
            message.innerText = "Please fill all fields";

        } else {
            message.innerText = "Registration failed";
        }

    } catch (error) {
        message.innerText = "Server error. Check backend path or Apache.";
        console.error(error);
    }
}

</script>

</body>
</html>
